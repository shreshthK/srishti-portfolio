#!/bin/bash
# ============================================================================
# HEALTH CHECK SCRIPT
# ============================================================================
# Generated by Ansible - Do not edit manually
# ============================================================================

HOST_PORT="{{ app_port | default(3000) }}"
HEALTH_PATH="/health"

# Check application health
if curl -sf "http://localhost:$HOST_PORT$HEALTH_PATH" > /dev/null 2>&1; then
    echo "Application: HEALTHY"
    APP_HEALTHY=true
else
    echo "Application: UNHEALTHY"
    APP_HEALTHY=false
fi

# Check Nginx
if curl -sf "http://localhost:80$HEALTH_PATH" > /dev/null 2>&1; then
    echo "Nginx: HEALTHY"
    NGINX_HEALTHY=true
else
    echo "Nginx: UNHEALTHY"
    NGINX_HEALTHY=false
fi

# Check Docker container
CONTAINER_STATUS=$(docker inspect --format='{{ '{{' }}.State.Status{{ '}}' }}' portfolio 2>/dev/null || echo "not found")
echo "Container: $CONTAINER_STATUS"

# Overall status
if [ "$APP_HEALTHY" = true ] && [ "$NGINX_HEALTHY" = true ] && [ "$CONTAINER_STATUS" = "running" ]; then
    echo ""
    echo "Overall Status: HEALTHY"
    exit 0
else
    echo ""
    echo "Overall Status: UNHEALTHY"
    exit 1
fi
